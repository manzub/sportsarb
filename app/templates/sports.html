{% extends 'base.html' %}

{% block content %}
<div class="py-10 px-6">
  <div class="max-w-5xl mx-auto">
    <h1 class="text-2xl font-bold text-gray-800 mb-6">Sports Data Overview</h1>

    {% if sports %}
    <div class="overflow-x-auto">
      <table class="min-w-full bg-white border border-gray-200 shadow-sm rounded-lg">
        <thead class="bg-gray-100 text-gray-700 uppercase text-sm">
          <tr>
            <th class="py-3 px-4 text-left">Sport</th>
            <th class="py-3 px-4 text-left">League</th>
            <th class="py-3 px-4 text-left">Favorite</th>
          </tr>
        </thead>
        <tbody class="text-gray-700">
          {% for item in sports %}
          <tr class="border-t border-gray-200 hover:bg-gray-50 transition">
            <td class="py-3 px-4 font-medium">{{ item.sport }}</td>
            <td class="py-3 px-4">{{ item.league }}</td>
            <td class="py-3 px-4 text-center">
              <input type="checkbox" class="favorite-checkbox" data-league="{{ item.league }}"
                data-sport="{{ item.sport }}" {% if item.is_favorite %}checked{% endif %}>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <p class="text-gray-600 mt-6">No sports data available yet.</p>
    {% endif %}
  </div>
</div>

<script>
  const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
  document.querySelectorAll('.favorite-checkbox').forEach(chk => {
    chk.addEventListener('change', async (e) => {
      const league = e.target.dataset.league;
      const isFavorite = e.target.checked;

      try {
        const res = await fetch('/api/sports/toggle-favorite', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'X-CSRFToken': csrfToken },
          body: JSON.stringify({ league, favorite: isFavorite })
        });
        const data = await res.json();
        if (!data.success) {
          e.target.checked = !isFavorite;
          alert('Failed to update favorite status.');
        }
      } catch (err) {
        console.error(err);
        e.target.checked = !isFavorite;
      }
    });
  });
</script>
{% endblock content %}