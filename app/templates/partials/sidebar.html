<aside
  class="sticky top-4 p-4 rounded-xl bg-base-100 shadow-lg border border-base-300">

  <!-- Banner -->
  <div class="mb-4">
    <img src="/static/images/sidebar-banner-2.jpg"
         class="w-full h-32 object-cover rounded-xl shadow-md">
  </div>

  <h3 class="text-lg font-bold tracking-tight mb-4">Filters</h3>

  <div class="space-y-6">

    {% if request.endpoint != 'main.valuebets' %}
    <!-- Sort -->
    <div class="p-3 rounded-lg bg-base-200 border border-base-300">
      <label class="font-semibold text-sm block mb-2">Sort</label>
      <div class="flex">
        <button type="button"
          class="rounded-l-md bg-base-300 border border-base-300 px-3 py-1 text-sm">â–¼</button>

        <select id="sort" name="selector[order]"
          class="rounded-r-md bg-base-100 border border-base-300 px-2 py-1 text-sm w-full">
          <option value="time">Commence Time</option>
          <option value="profit" selected>Profit</option>
        </select>
      </div>
    </div>
    {% endif %}

    <!-- Markets -->
    <div class="p-3 rounded-lg bg-base-200 border border-base-300">
      <label class="font-semibold text-sm block mb-2">Markets</label>
      <select id="market" class="select select-sm w-full select-bordered">
        <option disabled selected>Select</option>
        <option value="h2h">Head to Head (H2H)</option>
        <option value="spreads">Spreads</option>
        <option value="totals">Totals</option>
      </select>
    </div>

    {% if request.endpoint == 'main.index' %}
    <!-- Outcomes -->
    <div class="p-3 rounded-lg bg-base-200 border border-base-300">
      <label class="font-semibold text-sm block mb-2">Outcomes</label>

      <label class="flex items-center gap-2 text-sm cursor-pointer">
        <input type="checkbox" name="outcome_type" value="2way" class="checkbox checkbox-primary">
        2-Way Outcome
      </label>

      <label class="flex items-center gap-2 mt-2 text-sm cursor-pointer">
        <input type="checkbox" name="outcome_type" value="3way" class="checkbox checkbox-primary">
        3-Way Outcome
      </label>
    </div>
    {% endif %}

    <!-- Commence Time -->
    <div class="p-3 rounded-lg bg-base-200 border border-base-300">
      <label class="font-semibold text-sm block mb-2">Commence Time</label>
      <select id="commence_time" class="select select-sm w-full select-bordered">
        <option disabled selected>Select</option>
        <option value="4h">Next 4 hours</option>
        <option value="8h">Next 8 hours</option>
        <option value="12h">Next 12 hours</option>
        <option value="2d">Next 2 days</option>
        <option value="1w">1 week+</option>
      </select>
    </div>

    <!-- Links -->
    <div class="space-y-1 text-sm">
      <a href="{{url_for('main.bookmakers')}}" class="text-primary hover:underline">
        Bookmakers (394)
      </a>
      <a href="{{url_for('main.sports')}}" class="text-primary hover:underline">
        Sports (<span id="sports-count"></span>)
      </a>
      <a href="{{url_for('main.sports')}}" class="text-primary hover:underline">
        Tournaments (All)
      </a>
    </div>

    <!-- Buttons -->
    <div class="space-y-2">
      <button onclick="applyFilters()"
        class="btn btn-primary w-full">
        Apply Filters
      </button>

      <a href="" class="btn w-full bg-base-300 hover:bg-base-200">
        Reset
      </a>
    </div>

  </div>
</aside>

<script>
  async function applyFilters(page = 1) {
    const sort = document.getElementById('sort')?.value;
    const market = document.getElementById('market').value;
    const commence_time = document.getElementById('commence_time').value;

    const filters = document.querySelectorAll("input[name='outcome_type']");
    const selectedFilters = Array.from(filters)
                                .filter(x => x.checked)
                                .map(x => x.value);

    const path = window.location.pathname;

    if (path === "/") {
      fetchSurebets(1, sort, market, commence_time, selectedFilters.join(','));
    } else if (path === "/middles") {
      fetchMiddles(1, sort, market, commence_time);
    } else if (path === "/valuebets") {
      fetchValues(1, market, commence_time);
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    fetch('/api/sports')
      .then(r => r.json())
      .then(data => {
        document.getElementById('sports-count').textContent = data.total_sports;
      });
  });
</script>